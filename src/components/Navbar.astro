---
/**
 * Navbar Component
 * Transparent sticky header with glassmorphism effect
 * Responsive hamburger menu for mobile
 */

interface NavLink {
  label: string;
  href: string;
  isExternal?: boolean;
}

const navLinks: NavLink[] = [
  { label: 'About', href: '/about' },
  { label: 'Mission', href: '/mission' },
  { label: 'Technology', href: '/technology' },
  { label: 'Security', href: '/security' },
  { label: 'Contact', href: '/contact' },
];

const currentPath = Astro.url.pathname;
---

<header 
  id="navbar" 
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  role="banner"
>
  <div class="navbar-blur">
    <nav class="container-main" aria-label="Main navigation">
      <div class="flex items-center justify-between h-20">
        <!-- Logo -->
        <a 
          href="/" 
          class="flex items-center gap-3 group"
          aria-label="K Entertainment Studio - Home"
        >
          <!-- Logo Icon -->
          <div class="relative w-10 h-10 flex items-center justify-center">
            <div class="absolute inset-0 bg-gradient-to-br from-[var(--color-primary)] to-[var(--color-accent-purple)] rounded-lg opacity-20 group-hover:opacity-30 transition-opacity"></div>
            <svg 
              viewBox="0 0 40 40" 
              class="w-10 h-10 relative z-10"
              aria-hidden="true"
            >
              <defs>
                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#00d4ff" />
                  <stop offset="100%" style="stop-color:#a855f7" />
                </linearGradient>
              </defs>
              <!-- K Shape -->
              <path 
                d="M12 8v24M12 20l10-12M12 20l10 12" 
                stroke="url(#logoGradient)" 
                stroke-width="3" 
                stroke-linecap="round" 
                stroke-linejoin="round"
                fill="none"
              />
              <!-- Vault accent -->
              <circle cx="28" cy="20" r="6" stroke="url(#logoGradient)" stroke-width="2" fill="none" opacity="0.6" />
              <circle cx="28" cy="20" r="2" fill="url(#logoGradient)" opacity="0.8" />
            </svg>
          </div>
          <!-- Logo Text -->
          <div class="hidden sm:block">
            <span class="text-lg font-bold gradient-text">K Entertainment</span>
            <span class="text-xs text-[var(--color-text-muted)] block -mt-1">Studio Inc.</span>
          </div>
        </a>

        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center gap-8">
          {navLinks.map((link) => (
            <a
              href={link.href}
              class={`text-sm font-medium transition-colors link-hover ${
                currentPath === link.href 
                  ? 'text-[var(--color-primary)]' 
                  : 'text-[var(--color-text-secondary)] hover:text-[var(--color-text-primary)]'
              }`}
              aria-current={currentPath === link.href ? 'page' : undefined}
            >
              {link.label}
            </a>
          ))}
        </div>

        <!-- CTA Button & Mobile Menu Toggle -->
        <div class="flex items-center gap-4">
          <!-- Desktop CTA -->
          <a 
            href="/contact" 
            class="hidden md:inline-flex btn-primary text-sm"
          >
            <span>Join Waitlist</span>
            <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </a>

          <!-- Mobile Menu Button -->
          <button
            id="mobile-menu-toggle"
            type="button"
            class="lg:hidden relative w-10 h-10 flex items-center justify-center glass-card"
            aria-label="Toggle navigation menu"
            aria-expanded="false"
            aria-controls="mobile-menu"
          >
            <span class="sr-only">Open main menu</span>
            <!-- Hamburger Icon -->
            <div class="w-5 h-4 relative flex flex-col justify-between" id="hamburger-icon">
              <span class="w-full h-0.5 bg-[var(--color-text-primary)] transition-all duration-300 origin-center"></span>
              <span class="w-full h-0.5 bg-[var(--color-text-primary)] transition-all duration-300"></span>
              <span class="w-full h-0.5 bg-[var(--color-text-primary)] transition-all duration-300 origin-center"></span>
            </div>
          </button>
        </div>
      </div>
    </nav>
  </div>

  <!-- Mobile Navigation Menu -->
  <div 
    id="mobile-menu" 
    class="lg:hidden fixed inset-x-0 top-20 bottom-0 bg-[var(--color-bg-deep)]/95 backdrop-blur-xl transform translate-x-full transition-transform duration-300 ease-in-out z-40"
    aria-hidden="true"
  >
    <nav class="container-main py-8" aria-label="Mobile navigation">
      <div class="flex flex-col gap-4">
        {navLinks.map((link, index) => (
          <a
            href={link.href}
            class={`text-2xl font-semibold py-3 border-b border-[var(--glass-border)] transition-colors ${
              currentPath === link.href 
                ? 'text-[var(--color-primary)]' 
                : 'text-[var(--color-text-primary)] hover:text-[var(--color-primary)]'
            }`}
            style={`animation-delay: ${index * 50}ms`}
            aria-current={currentPath === link.href ? 'page' : undefined}
          >
            {link.label}
          </a>
        ))}
        
        <!-- Mobile CTA -->
        <a 
          href="/contact" 
          class="btn-primary text-center mt-6 py-4 text-lg"
        >
          Join Waitlist
        </a>
      </div>

      <!-- Mobile Menu Footer -->
      <div class="absolute bottom-8 left-0 right-0 px-4">
        <p class="text-sm text-[var(--color-text-muted)] text-center">
          The World's Centralized Intelligent Vault
        </p>
      </div>
    </nav>
  </div>
</header>

<script>
  // Mobile menu toggle functionality
  const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
  const mobileMenu = document.getElementById('mobile-menu');
  const hamburgerIcon = document.getElementById('hamburger-icon');
  
  let isMenuOpen = false;

  function toggleMenu() {
    isMenuOpen = !isMenuOpen;
    
    if (mobileMenu && mobileMenuToggle && hamburgerIcon) {
      mobileMenu.classList.toggle('translate-x-full', !isMenuOpen);
      mobileMenu.classList.toggle('translate-x-0', isMenuOpen);
      mobileMenu.setAttribute('aria-hidden', (!isMenuOpen).toString());
      mobileMenuToggle.setAttribute('aria-expanded', isMenuOpen.toString());
      
      // Animate hamburger to X
      const spans = hamburgerIcon.querySelectorAll('span');
      if (isMenuOpen) {
        spans[0].style.transform = 'rotate(45deg) translateY(7px)';
        spans[1].style.opacity = '0';
        spans[2].style.transform = 'rotate(-45deg) translateY(-7px)';
      } else {
        spans[0].style.transform = '';
        spans[1].style.opacity = '1';
        spans[2].style.transform = '';
      }
      
      // Prevent body scroll when menu is open
      document.body.style.overflow = isMenuOpen ? 'hidden' : '';
    }
  }

  mobileMenuToggle?.addEventListener('click', toggleMenu);

  // Close menu on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && isMenuOpen) {
      toggleMenu();
    }
  });

  // Close menu when clicking on a link
  mobileMenu?.querySelectorAll('a').forEach(link => {
    link.addEventListener('click', () => {
      if (isMenuOpen) {
        toggleMenu();
      }
    });
  });

  // Navbar scroll effect
  const navbar = document.getElementById('navbar');
  let lastScrollY = window.scrollY;

  function handleScroll() {
    const currentScrollY = window.scrollY;
    
    if (navbar) {
      // Add/remove background based on scroll position
      if (currentScrollY > 50) {
        navbar.classList.add('scrolled');
      } else {
        navbar.classList.remove('scrolled');
      }
      
      // Hide/show navbar based on scroll direction (optional)
      // Uncomment below for hide-on-scroll-down behavior
      /*
      if (currentScrollY > lastScrollY && currentScrollY > 100) {
        navbar.style.transform = 'translateY(-100%)';
      } else {
        navbar.style.transform = 'translateY(0)';
      }
      */
    }
    
    lastScrollY = currentScrollY;
  }

  window.addEventListener('scroll', handleScroll, { passive: true });
  handleScroll(); // Initial check
</script>

<style>
  #navbar.scrolled .navbar-blur {
    background: rgba(3, 7, 18, 0.95);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
  }
  
  #mobile-menu.translate-x-0 a {
    animation: slideIn 0.3s ease forwards;
    opacity: 0;
    transform: translateX(20px);
  }
  
  @keyframes slideIn {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
